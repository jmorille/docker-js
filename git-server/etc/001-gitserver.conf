<VirtualHost *:80>
   ServerName GF219896.groupe.generali.fr

   DocumentRoot /var/www

   ErrorLog ${APACHE_LOG_DIR}/git_error.log 
   CustomLog ${APACHE_LOG_DIR}/git_access.log combined 

   # TODO http://www.parallelsymmetry.com/howto/git.jsp
   SetEnv PATH_INFO $SCRIPT_URL
   SetEnv GIT_PROJECT_ROOT /var/www/git
   SetEnv GIT_HTTP_EXPORT_ALL true
   SetEnv REMOTE_USER $REDIRECT_REMOTE_USER
#   SetEnv REMOTE_ADDR $REDIRECT_REMOTE_ADDR

    ScriptAlias /git/ /usr/lib/git-core/git-http-backend/
#    ScriptAlias /git/ /var/www/git-http-backend/

#   ScriptAliasMatch "(?x)^/git/(.*/(HEAD | info/refs | objects/(info/[^/]+ | [0-9a-f]{2}/[0-9a-f]{38} | pack/pack-[0-9a-f]{40}\.(pack|idx)) | git-(upload|receive)-pack))$" /usr/lib/git-core/git-http-backend/$1

#   ScriptAlias /git/ /usr/share/gitweb/gitweb.cgi/**

   # To serve multiple repositories from different gitnamespaces(7) in a single repository:
   # SetEnvIf Request_URI "^/git/([^/]*)" GIT_NAMESPACE=$1
   # ScriptAliasMatch ^/git/[^/]*(.*) /usr/lib/git-core/git-http-backend/storage.git$1

   
   RewriteEngine On

    RewriteCond %{QUERY_STRING} service=git-receive-pack [OR]
    RewriteCond %{REQUEST_URI} /git-receive-pack$
    RewriteRule ^/git/ - [E=AUTHREQUIRED:yes]

   # Enable CGI on the gitweb directory
   #<Directory /usr/share/gitweb>
   #  Options +FollowSymLinks +ExecCGI
   #  AddHandler cgi-script .cgi
   #  DirectoryIndex gitweb.cgi
   #</Directory>

   #<LocationMatch "^/git/.*/git-receive-pack$">
   #   Options +ExecCGI
   #    Order allow,deny
       # Allow from all
   #    AuthUserFile /var/www/passwords
   #    Require valid-user
   #</LocationMatch>

  <LocationMatch "^/git/">
    Order Deny,Allow
    Deny from env=AUTHREQUIRED
    AuthType Basic
    AuthName "Git Access"
    AuthUserFile /var/www/passwords
    Require valid-user
    Satisfy Any

      Options +ExecCGI
#    AuthType Basic
#    AuthName "Git Access"
#    Order Allow,Deny
#       AuthUserFile /var/www/passwords
#       Require valid-user
  </LocationMatch>

</VirtualHost>
